# Running the API:

***npm install***

Start MongoDB service however you are supposed to on your system.

Typically, this means querying your package manager for an implementation and calling the system service manager.
npm start

--------------------------------------------------------------------------------------

# Authentication:

Authentication lasts for 1 week before needing to be redone, with the exception of the server restarting, which intentionally breaks sessions for security reasons. 

The client is served a single persistent AuthState cookie, containing a hash of the session ID against a secret that regenerates when the server restarts.

To continue your session, please serve this cookie to the API. Otherwise, you will need to reauthenticate.

Authentication is also rolling, calling the API refreshes the alloted time.

--------------------------------------------------------------------------------------

# Objects:

Listed here are the output JSON objects of the API. so this is what the front-end will see. 

Fields are sorted by their necessity for various requests, unless stated otherwise in the route doc. 

Mandatory fields MUST be provided for POST requests in the request body. 

Optional fields can be absent from POST requests in the request body. If so, they will be null. 

Database fields are fields generated by the database and provided to the user for extram information, and need never be submitted.

## Users:

### Mandatory fields
  
  *firstName*: A string between 2 and 25 characters long.
  
  *lastName*: A string between 2 and 25 characters long.
  
  *phoneNumber*: Currently just a nonempty string. I will add a validator eventually. Use your imagination though, its a string. 
  
  *state*: A non-empty string.

### Optional fields primarily for RPM customers.
  
  *address*: A non-empty string.
  
  *gender*: A non-empty string.
  
  *dateOfBirth*: A string formatted YYYY-MM-DD and set in the past. Yes, I check that it is past.
  
  *doctorName*: A non-empty string.
  
  *conditions*: An array of non-empty strings.
  
  *consentLetter*: A nonempty string.
  
### Completely optional. Validated on the server.

  *email*: A string with typical email formatting of USER@DOMAIN.TLD 
  
  *height*: A number in inches between 30 and 100.
  
  *weight*: A positive number.
  
### Database fields.

  *_id*: A MongoDB object ID formatted as a string.
  
  *meals*: An array of meal objects, see docs.
  
## Meals:

### Mandatory fields
  
  *name*: A nonempty string.
  
  *description*: A nonempty string describing the meal. 
  
### Database fields. 

  *_id*: A MongoDB object ID formatted as a string.
  
  *dateCreated*: A string showing the date and time the meal was added in UTC.

--------------------------------------------------------------------------------------

# Session Data:

The server stores a copy of the echoed user object as session data. For implementers, this field is req.session.user.

--------------------------------------------------------------------------------------

# ENDPOINTS:

## POST /register:

The request body should should be a user object. In addition, please include the following fields in the object as well.

*password*: A string at least 8 characters long. Cannot contain spaces. Must contain a number, an uppercase letter, and a special character from the set "!@#$%^&*():<>?,.;/[]\\-=`~'\"+{}|".

*confirmPassword*: A string that should match the *password* string.

Registers and authenticates and returns a JSON of the user object.

## POST /login:

Unlike register, you need only provide the following fields, corresponding to their counterparts in the user object.

  *phoneNumber*
  
  *password*: See POST /register.

Authenticates and returns a JSON of the user object.

## GET /user:

Must be authenticated first, see above.

Server returns a JSON of the user object if successful, and an error otherwise.

## DELETE /user:

Must be authenticated first, see above.

Server deletes the user object for the current user session.

Logs out and ends the session.

## PUT /user:

The request body should should be a partial user object. That is to say, you need not provide all fields, only those worth updating. In addition, you may also update this field.

*password*: A string at least 8 characters long. Cannot contain spaces. Must contain a number, an uppercase letter, and a special character from the set "!@#$%^&*():<>?,.;/[]\\-=`~'\"+{}|".

Note that providing any fields not specified in the user object or here will throw an error, you should not submit brand new fields to an update function.

You may also not update the "meals" field, for obvious reasons. See the user object for restrictions on other field values.

Returns a JSON of the new user object, and updates the session accordingly.

## GET /meals:

Must be authenticated first, see above.

Returns an expanded list of all meal objects belonging to the user.

## POST /meals:

Must be authenticated first, see above.

Please submit the mandatory meal fields.

Returns a JSON of the created meal, and updates the session accordingly.

## GET /meals/:id:

Must be authenticated first, see above.

Returns an expanded JSON of the meal specified in the id, assuming it belongs to the authenticated user.

## GET /logout:

Must be authenticated first, see above.

Logs out and ends the session.
